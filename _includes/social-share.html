{% include base_path %}

<section class="page__share">
  {% if site.data.ui-text[site.locale].share_on_label %}
    <h4 class="page__share-title">{{ site.data.ui-text[site.locale].share_on_label | default: "Share on" }}</h4>
  {% endif %}

  <!-- 保留 Facebook -->
  <a href="https://www.facebook.com/sharer/sharer.php?u={{ base_path | append: page.url | url_encode }}" class="btn btn--facebook" title="{{ site.data.ui-text[site.locale].share_on_label | default: 'Share on' }} Facebook">
    <i class="fab fa-facebook" aria-hidden="true"></i><span> Facebook</span>
  </a>

  <!-- 保留 X (原Twitter) -->
  <a href="https://x.com/intent/post?text={{ base_path | append: page.url | url_encode }}" class="btn btn--x" title="{{ site.data.ui-text[site.locale].share_on_label | default: 'Share on' }} X">
    <i class="fab fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <!-- 新增 QQ 分享 -->
  <a href="https://connect.qq.com/widget/shareqq/index.html?url={{ base_path | append: page.url | url_encode }}&title={{ page.title | url_encode }}" class="btn btn--qq" title="{{ site.data.ui-text[site.locale].share_on_label | default: 'Share on' }} QQ">
    <i class="fab fa-qq" aria-hidden="true"></i><span> QQ</span>
  </a>

  <!-- 新增 微信 分享 (注：微信网页分享需扫码，此处做常用实现) -->
  <a href="javascript:void(0);" class="btn btn--wechat" id="wechat-share" title="{{ site.data.ui-text[site.locale].share_on_label | default: 'Share on' }} 微信">
    <i class="fab fa-weixin" aria-hidden="true"></i><span> 微信</span>
  </a>

  <!-- 微信分享二维码弹窗 (可选，如需扫码功能添加) -->
  <div id="wechat-qrcode-modal" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:20px;border-radius:8px;box-shadow:0 0 20px rgba(0,0,0,0.2);z-index:9999;">
    <p style="text-align:center;margin-bottom:10px;">扫码分享到微信</p>
    <div id="wechat-qrcode" style="width:200px;height:200px;margin:0 auto;"></div>
    <button onclick="document.getElementById('wechat-qrcode-modal').style.display='none'" style="display:block;margin:10px auto;padding:8px 16px;cursor:pointer;">关闭</button>
  </div>

  <script>
    // 微信分享二维码生成逻辑 (需引入 qrcode.js，可自行CDN引入)
    document.getElementById('wechat-share').addEventListener('click', function() {
      const shareUrl = '{{ base_path | append: page.url | url_encode }}';
      const modal = document.getElementById('wechat-qrcode-modal');
      
      // 引入qrcode.js (如果未全局引入)
      if (!window.QRCode) {
        const script = document.createElement('script');
        script.src = 'https://cdn.bootcdn.net/ajax/libs/qrcodejs/1.0.0/qrcode.min.js';
        script.onload = function() {
          generateWechatQRCode(shareUrl);
        };
        document.body.appendChild(script);
      } else {
        generateWechatQRCode(shareUrl);
      }
      
      modal.style.display = 'block';
    });

    function generateWechatQRCode(url) {
      const qrcodeContainer = document.getElementById('wechat-qrcode');
      qrcodeContainer.innerHTML = ''; // 清空原有二维码
      new QRCode(qrcodeContainer, {
        text: decodeURIComponent(url),
        width: 200,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
      });
    }
  </script>
</section>
